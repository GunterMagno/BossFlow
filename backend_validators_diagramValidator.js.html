<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>backend/validators/diagramValidator.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#AbilityNode">AbilityNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ActionIcon">ActionIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ActionNode">ActionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ACTIVITY_STORAGE_PREFIX">ACTIVITY_STORAGE_PREFIX</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ACTIVITY_TYPES">ACTIVITY_TYPES</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#allowedOrigins">allowedOrigins</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#api">api</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#App">App</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#auth">auth</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#AuthProvider">AuthProvider</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#authService">authService</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#baseURL">baseURL</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#clearActivities">clearActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Community">Community</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#COMPATIBLE_VERSIONS">COMPATIBLE_VERSIONS</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ConfirmDialog">ConfirmDialog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ConfirmModal">ConfirmModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#connectDB">connectDB</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#createDiagram">createDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createTransporter">createTransporter</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CURRENT_VERSION">CURRENT_VERSION</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#CustomEdge">CustomEdge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Dashboard">Dashboard</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DecisionIcon">DecisionIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DecisionNode">DecisionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DEFAULT_TEMPLATES">DEFAULT_TEMPLATES</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteDiagram">deleteDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteImage">deleteImage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteTemplate">deleteTemplate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#DiagramCard">DiagramCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#DiagramList">DiagramList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Editor">Editor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#EditorSidebar">EditorSidebar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EffectIcon">EffectIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EffectNode">EffectNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EndNode">EndNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ExportHandler">ExportHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ExportModal">ExportModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#FlowMap">FlowMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Footer">Footer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#formatRelativeDate">formatRelativeDate</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getActivities">getActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCurrentUserId">getCurrentUserId</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getDiagramById">getDiagramById</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getDiagrams">getDiagrams</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getFormattedActivities">getFormattedActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getProfile">getProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getStats">getStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getStorageKey">getStorageKey</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getTemplates">getTemplates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Handles">Handles</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#healthCheck">healthCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Home">Home</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#http">http</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ImageNode">ImageNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ImportJSON">ImportJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isValidJSONFile">isValidJSONFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isVersionCompatible">isVersionCompatible</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Layout">Layout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Login">Login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#login">login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#logout">logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#MobileNodePanel">MobileNodePanel</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#mongoose">mongoose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Navbar">Navbar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NewDiagramModal">NewDiagramModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NewTemplateModal">NewTemplateModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeDescriptionPopup">NodeDescriptionPopup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeEditModal">NodeEditModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeTitle">NodeTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NotFound">NotFound</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PhaseIcon">PhaseIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PhaseNode">PhaseNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PositionNode">PositionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PrivateRoute">PrivateRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Profile">Profile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Register">Register</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#register">register</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#registerActivity">registerActivity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sendVerificationEmail">sendVerificationEmail</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sendWelcomeEmail">sendWelcomeEmail</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Sidebar">Sidebar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#StartEndIcon">StartEndIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#StartNode">StartNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startServer">startServer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Status">Status</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TemplateCard">TemplateCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TemplateList">TemplateList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Templates">Templates</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#TimerNode">TimerNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Toast">Toast</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ToastProvider">ToastProvider</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Toolbar">Toolbar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateDiagram">updateDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateProfile">updateProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#uploadImage">uploadImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#UploadImageModal">UploadImageModal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useAuth">useAuth</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#useExportDiagram">useExportDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useHealthCheck">useHealthCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#useRecentNodes">useRecentNodes</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useToast">useToast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateDiagramStructure">validateDiagramStructure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateEdge">validateEdge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateEdges">validateEdges</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateImageMetadata">validateImageMetadata</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateImageUrl">validateImageUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateJSONStructure">validateJSONStructure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateNode">validateNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateNodes">validateNodes</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">backend/validators/diagramValidator.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Valida los metadatos de una imagen.
 * @param {Object} image - Metadatos de la imagen a validar.
 * @param {string} image.filename - Nombre del archivo.
 * @param {string} image.url - URL de la imagen.
 * @param {string} image.mimeType - Tipo MIME (jpeg, png, gif, webp).
 * @param {number} image.size - Tamaño en bytes (máximo 5MB).
 * @param {string} context - Contexto para mensajes de error.
 * @returns {Object} Objeto con propiedades valid (boolean) y errors (array de strings).
 */
function validateImageMetadata(image, context) {
  const errors = [];
  const ALLOWED_MIME_TYPES = [
    "image/jpeg",
    "image/png",
    "image/gif",
    "image/webp",
  ];
  const MAX_SIZE = 5 * 1024 * 1024; // 5MB

  // Validar que la imagen es un objeto
  if (!image || typeof image !== "object") {
    return {
      valid: false,
      errors: [`${context}: debe ser un objeto válido`],
    };
  }

  // Validar filename (obligatorio)
  if (
    !image.filename ||
    typeof image.filename !== "string" ||
    image.filename.trim() === ""
  ) {
    errors.push(
      `${context}: el campo 'filename' es obligatorio y debe ser un string no vacío`
    );
  }

  // Validar url (obligatorio)
  if (!image.url || typeof image.url !== "string" || image.url.trim() === "") {
    errors.push(
      `${context}: el campo 'url' es obligatorio y debe ser un string no vacío`
    );
  }

  // Validar mimeType (obligatorio)
  if (!image.mimeType || typeof image.mimeType !== "string") {
    errors.push(
      `${context}: el campo 'mimeType' es obligatorio y debe ser un string`
    );
  } else if (!ALLOWED_MIME_TYPES.includes(image.mimeType)) {
    errors.push(
      `${context}: 'mimeType' debe ser uno de: ${ALLOWED_MIME_TYPES.join(", ")}`
    );
  }

  // Validar size (obligatorio)
  if (typeof image.size !== "number") {
    errors.push(
      `${context}: el campo 'size' es obligatorio y debe ser un número`
    );
  } else if (image.size &lt; 0) {
    errors.push(`${context}: 'size' debe ser mayor o igual a 0`);
  } else if (image.size > MAX_SIZE) {
    errors.push(`${context}: 'size' no puede exceder ${MAX_SIZE} bytes (5MB)`);
  }

  // Validar createdAt (opcional)
  if (
    image.createdAt !== undefined &amp;&amp;
    !(image.createdAt instanceof Date) &amp;&amp;
    isNaN(Date.parse(image.createdAt))
  ) {
    errors.push(`${context}: 'createdAt' debe ser una fecha válida`);
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Valida la estructura de un nodo del diagrama.
 * @param {Object} node - Nodo a validar.
 * @param {string} node.id - ID único del nodo.
 * @param {string} node.type - Tipo de nodo.
 * @param {Object} node.position - Posición del nodo {x, y}.
 * @param {Object} node.data - Datos del nodo.
 * @param {number} index - Índice del nodo en el array.
 * @returns {Object} Objeto con propiedades valid (boolean) y errors (array de strings).
 */
function validateNode(node, index) {
  const errors = [];

  // Validar que el nodo existe
  if (!node || typeof node !== "object") {
    return {
      valid: false,
      errors: [`Nodo en posición ${index}: debe ser un objeto válido`],
    };
  }

  // Validar campo 'id' (obligatorio)
  if (!node.id || typeof node.id !== "string" || node.id.trim() === "") {
    errors.push(
      `Nodo en posición ${index}: el campo 'id' es obligatorio y debe ser un string no vacío`
    );
  }

  // Validar campo 'type' (obligatorio)
  if (!node.type || typeof node.type !== "string" || node.type.trim() === "") {
    errors.push(
      `Nodo en posición ${index}: el campo 'type' es obligatorio y debe ser un string no vacío`
    );
  }

  // Validar campo 'position' (obligatorio)
  if (!node.position || typeof node.position !== "object") {
    errors.push(
      `Nodo en posición ${index}: el campo 'position' es obligatorio y debe ser un objeto`
    );
  } else {
    // Validar position.x
    if (typeof node.position.x !== "number") {
      errors.push(`Nodo en posición ${index}: 'position.x' debe ser un número`);
    }

    // Validar position.y
    if (typeof node.position.y !== "number") {
      errors.push(`Nodo en posición ${index}: 'position.y' debe ser un número`);
    }
  }

  // Validar campo 'data' (obligatorio, puede ser objeto vacío)
  if (node.data === undefined || node.data === null) {
    errors.push(
      `Nodo en posición ${index}: el campo 'data' es obligatorio (puede ser un objeto vacío {})`
    );
  } else if (typeof node.data !== "object") {
    errors.push(
      `Nodo en posición ${index}: el campo 'data' debe ser un objeto`
    );
  }

  // Validar campo 'image'
  if (node.image !== undefined &amp;&amp; node.image !== null) {
    const imageValidation = validateImageMetadata(
      node.image,
      `Nodo en posición ${index}, campo 'image'`
    );
    if (!imageValidation.valid) {
      errors.push(...imageValidation.errors);
    }
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Valida la estructura de un edge (conexión entre nodos)
 * @param {Object} edge - Edge a validar
 * @param {Array} nodes - Array de nodos para validar referencias
 * @returns {Object} { valid: boolean, errors: string[] }
 */
function validateEdge(edge, index, nodes = []) {
  const errors = [];

  // Validar que el edge existe
  if (!edge || typeof edge !== "object") {
    return {
      valid: false,
      errors: [`Edge en posición ${index}: debe ser un objeto válido`],
    };
  }

  // Validar campo 'id' (obligatorio)
  if (!edge.id || typeof edge.id !== "string" || edge.id.trim() === "") {
    errors.push(
      `Edge en posición ${index}: el campo 'id' es obligatorio y debe ser un string no vacío`
    );
  }

  // Validar campo 'source' (obligatorio)
  if (
    !edge.source ||
    typeof edge.source !== "string" ||
    edge.source.trim() === ""
  ) {
    errors.push(
      `Edge en posición ${index}: el campo 'source' es obligatorio y debe ser un string no vacío`
    );
  } else if (nodes.length > 0) {
    // Validar que el nodo source existe
    const sourceExists = nodes.some((node) => node.id === edge.source);
    if (!sourceExists) {
      errors.push(
        `Edge en posición ${index}: el nodo 'source' con id '${edge.source}' no existe`
      );
    }
  }

  // Validar campo 'target' (obligatorio)
  if (
    !edge.target ||
    typeof edge.target !== "string" ||
    edge.target.trim() === ""
  ) {
    errors.push(
      `Edge en posición ${index}: el campo 'target' es obligatorio y debe ser un string no vacío`
    );
  } else if (nodes.length > 0) {
    // Validar que el nodo target existe
    const targetExists = nodes.some((node) => node.id === edge.target);
    if (!targetExists) {
      errors.push(
        `Edge en posición ${index}: el nodo 'target' con id '${edge.target}' no existe`
      );
    }
  }

  // Validar que source y target son diferentes
  if (edge.source &amp;&amp; edge.target &amp;&amp; edge.source === edge.target) {
    errors.push(
      `Edge en posición ${index}: 'source' y 'target' no pueden ser el mismo nodo`
    );
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Valida el array completo de nodos.
 * @param {Array} nodes - Array de nodos a validar.
 * @returns {Object} Objeto con propiedades valid (boolean) y errors (array de strings).
 */
function validateNodes(nodes) {
  if (!Array.isArray(nodes)) {
    return {
      valid: false,
      errors: ['El campo "nodes" debe ser un array'],
    };
  }

  // Validar IDs únicos
  const nodeIds = nodes.map((n) => n?.id).filter(Boolean);
  const duplicateIds = nodeIds.filter(
    (id, index) => nodeIds.indexOf(id) !== index
  );

  if (duplicateIds.length > 0) {
    return {
      valid: false,
      errors: [
        `IDs de nodos duplicados: ${[...new Set(duplicateIds)].join(", ")}`,
      ],
    };
  }

  // Validar cada nodo individualmente
  const allErrors = [];
  nodes.forEach((node, index) => {
    const validation = validateNode(node, index);
    if (!validation.valid) {
      allErrors.push(...validation.errors);
    }
  });

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

/**
 * Valida el array completo de conexiones (edges).
 * @param {Array} edges - Array de edges a validar.
 * @param {Array} nodes - Array de nodos para validar referencias.
 * @returns {Object} Objeto con propiedades valid (boolean) y errors (array de strings).
 */
function validateEdges(edges, nodes = []) {
  if (!Array.isArray(edges)) {
    return {
      valid: false,
      errors: ['El campo "edges" debe ser un array'],
    };
  }

  // Validar IDs únicos
  const edgeIds = edges.map((e) => e?.id).filter(Boolean);
  const duplicateIds = edgeIds.filter(
    (id, index) => edgeIds.indexOf(id) !== index
  );

  if (duplicateIds.length > 0) {
    return {
      valid: false,
      errors: [
        `IDs de edges duplicados: ${[...new Set(duplicateIds)].join(", ")}`,
      ],
    };
  }

  // Validar cada edge individualmente
  const allErrors = [];
  edges.forEach((edge, index) => {
    const validation = validateEdge(edge, index, nodes);
    if (!validation.valid) {
      allErrors.push(...validation.errors);
    }
  });

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

/**
 * Valida la estructura completa del diagrama (nodos, edges e imágenes).
 * @param {Object} diagramData - Datos del diagrama.
 * @param {Array} diagramData.nodes - Array de nodos (opcional, por defecto []).
 * @param {Array} diagramData.edges - Array de edges (opcional, por defecto []).
 * @param {Array} diagramData.images - Array de imágenes (opcional, por defecto []).
 * @returns {Object} Objeto con propiedades valid (boolean) y errors (array de strings).
 */
function validateDiagramStructure(diagramData) {
  const { nodes = [], edges = [], images = [] } = diagramData;
  const allErrors = [];
  const MAX_IMAGES = 10;

  // Validar imágenes del diagrama
  if (!Array.isArray(images)) {
    allErrors.push('El campo "images" debe ser un array');
  } else {
    if (images.length > MAX_IMAGES) {
      allErrors.push(
        `Un diagrama no puede tener más de ${MAX_IMAGES} imágenes`
      );
    }

    images.forEach((image, index) => {
      const imageValidation = validateImageMetadata(
        image,
        `Imagen del diagrama en posición ${index}`
      );
      if (!imageValidation.valid) {
        allErrors.push(...imageValidation.errors);
      }
    });
  }

  // Validar nodos
  const nodesValidation = validateNodes(nodes);
  if (!nodesValidation.valid) {
    allErrors.push(...nodesValidation.errors);
  }

  // Validar edges (solo si los nodos son válidos para evitar errores en cascada)
  if (nodesValidation.valid) {
    const edgesValidation = validateEdges(edges, nodes);
    if (!edgesValidation.valid) {
      allErrors.push(...edgesValidation.errors);
    }
  } else {
    // Si los nodos no son válidos, validar edges sin referencias
    const edgesValidation = validateEdges(edges, []);
    if (!edgesValidation.valid) {
      allErrors.push(...edgesValidation.errors);
    }
  }

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

module.exports = {
  validateImageMetadata,
  validateNode,
  validateEdge,
  validateNodes,
  validateEdges,
  validateDiagramStructure,
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Dec 11 2025 12:13:38 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
